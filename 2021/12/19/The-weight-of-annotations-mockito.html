<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    The weight of annotations @Mock and @MockBean - Xavier Bouclet
    
  </title>

  <meta name="description" content="The weight of annotations @Mock and @MockBean 1. Purpose of this blog post">

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úçüèª</text></svg>">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/vendor/highlight/css/syntax_github.css">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://startbootstrap.github.io/2021/12/19/The-weight-of-annotations-mockito.html">
  <link rel="alternate" type="application/rss+xml" title="Xavier Bouclet" href="/feed.xml">

  <script defer data-domain="xavierbouclet.com" src="https://plausible.io/js/script.js"></script>
</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">Xavier Bouclet</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/conferences">Talks</a>
        </li>
<!--        Deactivated because of cors-->
<!--        <li class="nav-item">-->
<!--          <a class="nav-link" href="/contact">Contact</a>-->
<!--        </li>-->
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

<header class="masthead" style="background-image: url('/img/posts/2021-12-19-mockito2.jpg')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-10 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>The weight of annotations @Mock and @MockBean</h1>
            
            <h2 class="subheading">The weight of annotations @Mock and @MockBean</h2>
            
            <span class="meta">Posted by
              <a href="#">Xavier Bouclet</a>
              on December 19, 2021 &middot; <span class="reading-time" title="Estimated read time">
  
   13 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-md-10 mx-auto">

        <h1>The weight of annotations @Mock and @MockBean</h1>
<div class="sect1">
<h2 id="1_purpose_of_this_blog_post">1. Purpose of this blog post</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once I run a test class with the MockitoExtension within Intellij Idea.
I was amazed by the time it took to execute a simple test : 0.5 second.</p>
</div>
<div class="paragraph">
<p>Not big you might say. Unfortunately in a big code base time adds up and we end with minutes in the test phase.</p>
</div>
<div class="paragraph">
<p>So I decided to investigate what we should do to improve the test time.</p>
</div>
<div class="paragraph">
<p>You will read the experiment and the results of my investigation at the conclusion of this article.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="2_how_to_mock_with_mockito">2. How to mock with Mockito ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When doing unit testing, we often have to use mock to avoid building complex objects.
To help us, we have Mock frameworks such has <a href="https://site.mockito.org/">Mockito</a>.
We have 2 ways to build our mock objects :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The "mock(Class&lt;T&gt; classToMock)" method</p>
</li>
<li>
<p>The "@Mock" annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And since I develop mostly Spring Boot project at the moment, I will add a third option :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The "@MockBean" annotation</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="2_1_the_mockclasst_classtomock_method">2.1. The "mock(Class&lt;T&gt; classToMock)" method</h3>
<div class="paragraph">
<p>The mock method creates an object of the parameter class and we can add afterwards the behaviour we wanna have.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="nc">SimpleObject</span> <span class="n">simpleObject</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">SimpleObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="2_2_the_mock_annotation">2.2. The "@Mock" annotation</h3>
<div class="paragraph">
<p>The mock annotation do the same as the mock method without the boilerplate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="nd">@Mock</span>
    <span class="nc">SimpleObject</span> <span class="n">simpleObject</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It uses the MockitoExtension at the class level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">MockitoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="2_3_the_mockbean_annotation">2.3. The "@MockBean" annotation</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="nd">@MockBean</span>
    <span class="nc">SimpleObject</span> <span class="n">simpleObject</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It uses the SpringExtension at the class level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">SpringExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="3_the_experiment">3. The experiment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within a Spring Boot project, we have 4 tests :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Test - class test executed at first of the run to avoid weird result related to the start of our test execution.</p>
</li>
<li>
<p>SimpleObjectMockTest - the test class which uses the mock method</p>
</li>
<li>
<p>SimpleObjectAnnotationTest - the test class which uses the annotation @Mock</p>
</li>
<li>
<p>SimpleObjectMockBeanTest -  the test class which uses the annotation @MockBean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We have 2 objects that we will mock in our tests :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SimpleObject</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleObject</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">name</span><span class="o">=</span><span class="s">""</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">name</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>AnotherSimpleObject</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnotherSimpleObject</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">name</span><span class="o">=</span><span class="s">""</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">name</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use Lombok to avoid boilerplate.</p>
</div>
<div class="sect2">
<h3 id="3_1_test">3.1. Test</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">A_Test</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">simpleTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"useless test to avoid "</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="3_2_simpleobjectmocktest">3.2. SimpleObjectMockTest</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">SimpleObjectMockTest</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">SimpleObject</span> <span class="n">simpleObject</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">SimpleObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="nc">AnotherSimpleObject</span> <span class="n">anotherSimpleObject</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">AnotherSimpleObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">NAME</span> <span class="o">=</span> <span class="s">"mock()"</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">simpleTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">when</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">anotherSimpleTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">when</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="3_3_simpleobjectannotationtest">3.3. SimpleObjectAnnotationTest</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">MockitoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">C_SimpleObjectAnnotationTest</span> <span class="o">{</span>

    <span class="nd">@Mock</span>
    <span class="nc">SimpleObject</span> <span class="n">simpleObject</span><span class="o">;</span>

    <span class="nd">@Mock</span>
    <span class="nc">AnotherSimpleObject</span> <span class="n">anotherSimpleObject</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">NAME</span><span class="o">=</span><span class="s">"@Mock"</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">simpleTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">when</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">anotherSimpleTest</span><span class="o">(){</span>
        <span class="n">when</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="3_4_simpleobjectmockbeantest">3.4. SimpleObjectMockBeanTest</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">SpringExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">B_SimpleObjectMockBeanTest</span> <span class="o">{</span>

    <span class="nd">@MockBean</span>
    <span class="nc">SimpleObject</span> <span class="n">simpleObject</span><span class="o">;</span>

    <span class="nd">@MockBean</span>
    <span class="nc">AnotherSimpleObject</span> <span class="n">anotherSimpleObject</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">NAME</span><span class="o">=</span><span class="s">"Mock"</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">simpleTest</span><span class="o">(){</span>
        <span class="n">when</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">simpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">anotherSimpleTest</span><span class="o">(){</span>
        <span class="n">when</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">anotherSimpleObject</span><span class="o">.</span><span class="na">name</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="no">NAME</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="3_5_the_test_runs">3.5. The test runs</h3>
<div class="paragraph">
<p>In order to have consistent results that we can analyse we are gonna mix execution order.
Prior to the tests, I would have thought that the fastest would be the mock method, then MockitoExtension and the SpringExtension.
Indeed, the annotations need to be processed and SpringExtension in my mind was only for Spring Bean.</p>
</div>
<div class="paragraph">
<p>The tests are run through Maven and to have a specific order we use a specific surefire configuration to run our test classes in a specific order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;plugin&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;configuration&gt;</span>
		<span class="nt">&lt;runOrder&gt;</span>alphabetical<span class="nt">&lt;/runOrder&gt;</span>
	<span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The test "Test" is always executed first, so we have 6 execution order.</p>
</div>
<table class="tableblock frame-ends grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Execution order</th>
<th class="tableblock halign-left valign-top">Time in seconds</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p>
<p class="tableblock">SimpleObjectAnnotationTest</p>
<p class="tableblock">SimpleObjectMockBeanTest</p>
<p class="tableblock">SimpleObjectMockTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.008</p>
<p class="tableblock">0.215</p>
<p class="tableblock">0.207</p>
<p class="tableblock">0.001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p>
<p class="tableblock">SimpleObjectAnnotationTest</p>
<p class="tableblock">SimpleObjectMockTest</p>
<p class="tableblock">SimpleObjectMockBeanTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.007</p>
<p class="tableblock">0.218</p>
<p class="tableblock">0.211</p>
<p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p>
<p class="tableblock">SimpleObjectMockTest</p>
<p class="tableblock">SimpleObjectAnnotationTest</p>
<p class="tableblock">SimpleObjectMockBeanTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.008</p>
<p class="tableblock">0.214</p>
<p class="tableblock">0.008</p>
<p class="tableblock">0.215</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p>
<p class="tableblock">SimpleObjectMockTest</p>
<p class="tableblock">SimpleObjectMockBeanTest</p>
<p class="tableblock">SimpleObjectAnnotationTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.008</p>
<p class="tableblock">0.206</p>
<p class="tableblock">0.209</p>
<p class="tableblock">0.009</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p>
<p class="tableblock">SimpleObjectMockBeanTest</p>
<p class="tableblock">SimpleObjectMockTest</p>
<p class="tableblock">SimpleObjectAnnotationTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.009</p>
<p class="tableblock">0.419</p>
<p class="tableblock">0</p>
<p class="tableblock">0.007</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p>
<p class="tableblock">SimpleObjectMockBeanTest</p>
<p class="tableblock">SimpleObjectAnnotationTest</p>
<p class="tableblock">SimpleObjectMockTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.008</p>
<p class="tableblock">0.427</p>
<p class="tableblock">0.007</p>
<p class="tableblock">0.001</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The results are not the ones I expected.
And I would say it has to be because the JVM is warming up.
Indeed, when the MockBean are executed first, the other tests are almost instantaneous.</p>
</div>
<table class="tableblock frame-ends grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Test</th>
<th class="tableblock halign-left valign-top">Average time in seconds</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleObjectAnnotationTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111.83</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleObjectMockTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">105.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleObjectMockBeanTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">246.33</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The average of each test is what I expected.</p>
</div>
</div>
<div class="sect2">
<h3 id="3_6_one_execution_at_a_time">3.6. One execution at a time</h3>
<table class="tableblock frame-ends grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Test</th>
<th class="tableblock halign-left valign-top">Average time in seconds</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleObjectAnnotationTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">235.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleObjectMockTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleObjectMockBeanTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">38.2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once again, the results are not the ones I expected.
I don&#8217;t understand why the @MockBean is as fast as the mock method and the @Mock is more than 6 times slower than the mock method.
I used Intellij Ultimate in my tests, and I thought at first than be Spring was more optimized, but I tried in Eclipse as well and the results were the same.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t hesitate to reach out to me if you have an explanation about that.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="4_conclusion">4. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In conclusion, the mock method is faster than the others ways but as soon as the JVM has warmed up the tests are almost instantaneous.</p>
</div>
<div class="paragraph">
<p>If we take 0.001 second for the mock method and 0.007 second for the @Mock method.</p>
</div>
<div class="paragraph">
<p>We would be able to execute 1000 tests on 1 second with the mock method and 143 tests.</p>
</div>
<div class="paragraph">
<p>I can&#8217;t explain why in the IDE the MockBean annotation is way faster than the Mock annotation, and I am gonna look into that matter. And I won&#8217;t use the SpringExtension in favor of the MockitoExtension because it relly on Spring and I prefer to have my test unaware of what framework is behind the scene, in case I want to move away from Spring Boot in favor of Micronaut or Quarkus.</p>
</div>
<div class="paragraph">
<p>Depending on what you prefer execution time or readability you can favor one method over the other.</p>
</div>
<div class="paragraph">
<p>If you want to look in details you can find the source code on my <a href="https://github.com/mikrethor/mockito-annotation.git">Github</a></p>
</div>
</div>
</div>

        <hr>

        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/2021/10/13/Bad-Way-Of-Using-Flyway-In-SpringBoot.html" data-toggle="tooltip" data-placement="top" title="Which of Flyway or JPA should be responsible of generating your db structure?">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          
          <a class="btn btn-primary float-right" href="/2022/06/30/H2-TestContainers-PostgreSQL.html" data-toggle="tooltip" data-placement="top" title="Be specific with your Spring data repositories">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          

        </div>

      </div>
    </div>
  </div>

  <footer class="entry-meta">
    
    
<section class="post-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'https-mikrethor-github-io-blog'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


    
  </footer>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:mikrethor@gmail.com.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/XavierBOUCLET">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          <li class="list-inline-item">
            <a href="https://www.linkedin.com/in/üá®üá¶-xavier-bouclet-667b0431/">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://github.com/mikrethor">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; Xavier Bouclet 2025</p>
      </div>
    </div>
  </div>
</footer>


  <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>




  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XVG0Q9ZG4E"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XVG0Q9ZG4E');
</script>


  

</body>

</html>
